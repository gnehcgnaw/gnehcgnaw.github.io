<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/apple-touch-icon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="">
  <meta name="author" content="gnehcgnaw">
  <meta name="keywords" content="">
  <title>Mybatis初始化(一) ~ MartinAdam&#39;s blog</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>MartinAdam&#39;s blog</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期四, 十一月 28日 2019, 8:39 晚上
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    4.5k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      19 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h1 id="Mybatis初始化-一"><a href="#Mybatis初始化-一" class="headerlink" title="Mybatis初始化(一)"></a>Mybatis初始化(一)</h1><hr>
<p><strong>因为篇幅的原因，此部分只分析mybatis-config.xml配置文件的解析。</strong></p>
<hr>
<p>类似于<code>Spring</code>，<code>Mybatis</code>等灵活性和扩展性都很高的开源框架都提供了很多配置项，开发人员需要在使用时提供相应的配置信息，实现相应的需求。<code>Mybatis</code>中的配置文件主要有两个，分别是<code>mybatis-config.xml</code>配置文件和映射配置文件。</p>
<p>现在主流的配置方式除了使用XML配置文件，还会配合注解进行配置。在<code>Mybatis</code>初始化过程中，除了会读取<code>mybatis-config.xml</code>配置文件以及映射配置文件，还会加载配置文件指定的类，处理类中的注解，创建一些配置对象，最终完成框架中各个模块的初始化。另外，也可以使用<code>Java API</code>方式对<code>Mybatis</code>进行配置，这种硬编码的配置方式主要用在配置量比较少且配置信息不常变化的场景下。</p>
<h1 id="1-建造者模式"><a href="#1-建造者模式" class="headerlink" title="1. 建造者模式"></a>1. 建造者模式</h1><h1 id="2-BaseBuidler"><a href="#2-BaseBuidler" class="headerlink" title="2. BaseBuidler"></a>2. BaseBuidler</h1><p><code>BaseBuilder</code>的子类如下所示：</p>
<img src="https://gnehcgnaw.oss-cn-hongkong.aliyuncs.com/blog/20191128141904-lVPgr8.png" srcset="undefined" style="zoom:50%;" />

<p>因为<code>VelocitySqlSourceBuilder</code>只是一个测试用例，所以我暂且不把它划为<code>BaseBuilder</code>，包括其静态内部类</p>
<p><code>ParameterMappingTokenHandler</code>，这样<code>BaseBuilder</code>的子类结构图就如下所示：</p>
<p><img src="https://gnehcgnaw.oss-cn-hongkong.aliyuncs.com/blog/20191128142203-inbhpO.png" srcset="undefined" alt=""></p>
<p>正如签名所示，<code>Mybatis</code>的初始化过程使用了建造者模式，这里的<code>BaseBuilder</code>抽象类就扮演了建造者接口的角色。<code>BaseBuilder</code>中的核心字段的含义如下：</p>
<ul>
<li><code>Configuration</code></li>
<li><a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html#3-TypeHandlerRegistry" target="_blank" rel="noopener">TypeHandlerRegistry</a></li>
<li><a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html#4-TypeAliasRegistry" target="_blank" rel="noopener">TypeAliasRegistry</a></li>
</ul>
<pre><code class="java"> /**
  * Configuration对象是Mybatis初始化过程中的核心对象，Mybatis中几乎所有配置信息都会保存到Configuration对象中。
  * 
   * Configuration对象是Mybatis初始化过程中创建的且是全局唯一的。
   * 也有人称它是一个“All in One” 对象
   */
  protected final Configuration configuration;
  /**
   * 在mybatis-config.xml配置文件中可以使用&lt;typeAliases&gt;&lt;/typeAliases&gt;标签定义别名，这些定义的别名都会记录在TypeAliasesRegistry对象中
   */
  protected final TypeAliasRegistry typeAliasRegistry;
  /**
   * 在mybatis-config.xml配置文件中可以使用&lt;typeHandler&gt;&lt;/typeHandler&gt;标签定义添加的自定义的TypeHandler，
   * 完成指定数据库类型与Java类型的转换，这些TypeHandler都会记录在TypeHandlerRegistry中
   */
  protected final TypeHandlerRegistry typeHandlerRegistry;</code></pre>
<p><code>BaseBuilder</code>中记录的<code>TypeAliasRegistry</code>对象和<code>TypeHandlerRegistry</code>对象，其实是全局唯一的，它们都是在<code>Configuration</code>对象初始化时创建的，代码如下所示：</p>
<p><img src="https://gnehcgnaw.oss-cn-hongkong.aliyuncs.com/blog/20191128145108-dgZGGY.png" srcset="undefined" alt=""></p>
<p>在<code>BaseBuilder</code>构造函数中，通过相应的<code>Configuration.get*()</code>方法得到<code>TypeAliasRegistry</code>和<code>TypeHandlerRegistry</code>对象，并赋值给<code>BaseBuilder</code>相应的字段。</p>
<pre><code class="java">  /**
   * 构造方法
   * @param configuration
   */
  public BaseBuilder(Configuration configuration) {
    this.configuration = configuration;
    this.typeAliasRegistry = this.configuration.getTypeAliasRegistry();
    this.typeHandlerRegistry = this.configuration.getTypeHandlerRegistry();
  }</code></pre>
<p><code>Configuration</code>中还包含了很多配置项，为了便于读者理解，这里不会罗杰出内个字段的含义，而是在后面介绍的过程中，每涉及到一个配置项时，会结合其在<code>Configuration</code>中相应字段进行详细分析。</p>
<p><code>BaseBuilder.resolveAlias()</code>方法依赖<code>TypeAliasRegistry</code>解析别名，<code>BaseBuilder.resolveTypeHandler()</code>方法依赖<code>TypeHandlerRegistry</code>查找指定的<code>TypeHandler</code>对象。在阅读完<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html#4-TypeAliasRegistry" target="_blank" rel="noopener">TypeAliasRegistry</a>和<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E7%B1%BB%E5%9E%8B%E8%BD%AC%E6%8D%A2.html#3-TypeHandlerRegistry" target="_blank" rel="noopener">TypeHandlerRegistry</a>的相关实现的介绍后，<code>BaseBuilder.resolveAlias()</code>和<code>BaseBuilder.resolveTypeHandler()</code>就不难理解了。</p>
<p>前面提到过，<code>Mybatis</code>使用<code>JdbcType</code>枚举类型表示<code>JDBC</code>类型。<code>Mybatis</code>中常用的枚举类型还有<code>ResultSetType</code>和<code>ParameterMode</code>：</p>
<ul>
<li><code>ResultSetType</code>枚举表示结果集类型；</li>
<li><code>ParameterMode</code>枚举类型表示存储过程中的参数类型。</li>
</ul>
<p>在<code>BaseBuilder</code>中提供了相应的<code>resolveJdbcType()</code>、<code>resolveResultSetType()</code>、<code>resolveParameterMode()</code>方法，将<code>String</code>转换成对应的枚举类型，实现比较简单。</p>
<h1 id="3-XMLConfigBuilder"><a href="#3-XMLConfigBuilder" class="headerlink" title="3. XMLConfigBuilder"></a>3. XMLConfigBuilder</h1><p><code>XMLConfigBuilder</code>是<code>BaseBuilder</code>的众多子类之一，它扮演的是具体建造者的角色。<code>XMLConfigBuilder</code>主要负责解析<code>mybatis-config.xml</code>配置文件，其核心字段如下：</p>
<ul>
<li><a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E8%A7%A3%E6%9E%90%E5%99%A8%E6%A8%A1%E5%9D%97.html#4-XPathParser" target="_blank" rel="noopener">XPathParser</a></li>
<li><a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E8%A7%A3%E6%9E%90%E5%99%A8%E6%A8%A1%E5%9D%97.html#4-XPathParser" target="_blank" rel="noopener">ReflectorFactory</a></li>
</ul>
<pre><code class="java">/**
   *   标识是否被解析过mybatis-config.xml
   */
  private boolean parsed;
  /**
   * 用于解析mybatis-config.xml配置文件的XPathParse对象，
   */
  private final XPathParser parser;
  /**
   * 标识&lt;environment&gt;&lt;environment/&gt;配置的名称，默认读取&lt;environment&gt;&lt;environment/&gt;标签的default属性
   */
  private String environment;
  /**
   * ReflectorFactory负责创建和缓存Reflector对象
   */
  private final ReflectorFactory localReflectorFactory = new DefaultReflectorFactory();</code></pre>
<p><code>XMLConfigBuilder.parse()</code>方法是解析<code>mybatis-config.xml</code>配置文件的入口，它通过调用<code>XMLConfigBuilder.parseConfiguration()</code>方法实现整个解析过程，具体实现如下所示：</p>
<pre><code class="java">//XMLConfigBuilder.java
/**
   * 解析配置：
   *    这里其实有一个细节，就是{@link #parsed} 字段，这是一个boolbean类型的，也就是默认值是false，
   *    根据以下代码，发现只有当parsed = false才回去解析配置，为true的时候不会去解析，直接抛出异常，
   *    这么做的原因是：因为在解析mybatis中配置文件的时候是一件很消耗性能的事情，所以只解析一次。
   * @return configuration配置 （e.g. &lt;configuration&gt; ....&lt;configuration/&gt;）
   */
  public Configuration parse() {
    if (parsed) {
      throw new BuilderException(&quot;Each XMLConfigBuilder can only be used once.&quot;);
    }
    parsed = true;
    //在mybatis-config.xml配置文件中查找&lt;configuration&gt;&lt;/configuration&gt;节点，并开始解析
    parseConfiguration(parser.evalNode(&quot;/configuration&quot;));
    return configuration;
  }</code></pre>
<pre><code class="java">//XMLConfigBuilder.java
/**
   * 解析Configuration标签中的配置
   * @param root
   */
  private void parseConfiguration(XNode root) {
    try {
      //issue #117 read properties first
      //解析&lt;properties&gt;节点
      propertiesElement(root.evalNode(&quot;properties&quot;));
      // 解析&lt;settings&gt;节点
      Properties settings = settingsAsProperties(root.evalNode(&quot;settings&quot;));
      //设置vfsImpl字段
      loadCustomVfs(settings);
      //设置logImpl字段
      loadCustomLogImpl(settings);
      // 解析&lt;typeAliases&gt;节点
      typeAliasesElement(root.evalNode(&quot;typeAliases&quot;));
      // 解析&lt;plugins&gt;节点
      pluginElement(root.evalNode(&quot;plugins&quot;));
      // 解析&lt;objectFactory&gt;节点
      objectFactoryElement(root.evalNode(&quot;objectFactory&quot;));
      // 解析&lt;objectWrapperFactory&gt;节点
      objectWrapperFactoryElement(root.evalNode(&quot;objectWrapperFactory&quot;));
      // 解析&lt;reflectorFactory&gt;节点
      reflectorFactoryElement(root.evalNode(&quot;reflectorFactory&quot;));
      //将settings值设置到Configuration中
      settingsElement(settings);
      // read it after objectFactory and objectWrapperFactory issue #631
      // 解析&lt;environments&gt;节点
      environmentsElement(root.evalNode(&quot;environments&quot;));
      // 解析&lt;databaseIdProvider&gt;节点
      databaseIdProviderElement(root.evalNode(&quot;databaseIdProvider&quot;));
      // 解析&lt;typeHandlers&gt;节点
      typeHandlerElement(root.evalNode(&quot;typeHandlers&quot;));
      // 解析&lt;mappers&gt;节点
      mapperElement(root.evalNode(&quot;mappers&quot;));
    } catch (Exception e) {
      throw new BuilderException(&quot;Error parsing SQL Mapper Configuration. Cause: &quot; + e, e);
    }
  }
</code></pre>
<p><code>parseConfiguration()</code>方法的代码还是比较整洁的，我们可以清楚地看到，<code>XMLConfigBuilder</code>将<code>mybatis-config.xml</code>配置文件中每一个节点的解析过程封装成一个相应的方法，本小节的后续内容将逐一分析这些节点的解析过程。</p>
<h2 id="3-1-解析-lt-properties-gt-节点"><a href="#3-1-解析-lt-properties-gt-节点" class="headerlink" title="3.1. 解析&lt;properties&gt;节点"></a>3.1. 解析<code>&lt;properties&gt;</code>节点</h2><p><code>XMLConfigBuilder.propertiesElement()</code>方法会解析<code>mybatis-config.xml</code>配置文件中的<code>&lt;properties&gt;</code>节点，并信形成<code>java.uitl.Properties</code>对象，之后将该<code>Properties</code>对象设置到<code>XPathParser</code>和<code>Configuration</code>的<code>variable</code>字段中。在后面的解析过程中，会使用该<code>Properties</code>对象中的信息替换占位符。<code>propertiesElement()</code>方法的具体实现如下所示：</p>
<pre><code class="java">/**
   * `XMLConfigBuilder.propertiesElement()`方法会解析`mybatis-config.xml`配置文件中的`&lt;properties&gt;`节点，
   * 并信形成`java.uitl.Properties`对象，之后将该`Properties`对象设置到`XPathParser`和`Configuration`的`variable`字段中。
   * 在后面的解析过程中，会使用该`Properties`对象中的信息替换占位符。
   * @param context  e.g. &lt;properties resource=&quot;resources/config.properties&quot;&gt;
   *                         &lt;property name=&quot;username&quot; value=&quot;xxx&quot;/&gt;
   *                         &lt;property name=&quot;password&quot; value=&quot;xxx&quot;/&gt;
   *                      &lt;/properties&gt;
   * @throws Exception
   */
  private void propertiesElement(XNode context) throws Exception {
    if (context != null) {
      // username = xxx 和password = xxx 两个
      Properties defaults = context.getChildrenAsProperties();
      String resource = context.getStringAttribute(&quot;resource&quot;);
      String url = context.getStringAttribute(&quot;url&quot;);
      //properties元素不能同时指定URL和基于资源的属性文件引用。请指定其中一个。
      if (resource != null &amp;&amp; url != null) {
        throw new BuilderException(&quot;The properties element cannot specify both a URL and a resource based property file reference.  Please specify one or the other.&quot;);
      }
      //这个其实就是使用外部化配置覆盖内部值
      if (resource != null) {
        defaults.putAll(Resources.getResourceAsProperties(resource));
      } else if (url != null) {
        defaults.putAll(Resources.getUrlAsProperties(url));
      }
      Properties vars = configuration.getVariables();
      if (vars != null) {
        defaults.putAll(vars);
      }
      //更新XPathParser和Configuration的variable字段
      parser.setVariables(defaults);
      configuration.setVariables(defaults);
    }
  }
</code></pre>
<h2 id="3-2-解析-lt-settings-gt-节点"><a href="#3-2-解析-lt-settings-gt-节点" class="headerlink" title="3.2. 解析&lt;settings&gt;节点"></a>3.2. 解析<code>&lt;settings&gt;</code>节点</h2><p><code>XMLConfigBuilder.settingsAsProperties()</code>方法负责解析<code>&lt;settings&gt;</code>节点，在<code>&lt;settings&gt;</code>节点下的配置是<strong>Mybatis全局性的配置</strong>，它们会改变<code>Mybatis</code>的运行时行为，具体的配置项的含义请阅读参考<a href="https://mybatis.org/mybatis-3/configuration.html#settings" target="_blank" rel="noopener">Mybatis官方文档</a>。需要注意的是，在<code>Mybatis</code>初始化时，这些全局配置信息都会被记录到<code>Configuration</code>对象的对应属性中。例如，开发人员可以通过设置————————。</p>
<p>在<code>Configuration</code>中存在一个同名的相应字段，如下：</p>
<p><code>settingsAsProperties()</code>方法的解析方式和<code>propertiesElement()</code>方法类似，但是多了使用<code>MetaClass</code>检测<code>key</code>指定的属性在<code>Configuration</code>类中是否有对应<code>setter</code>方法的步骤。<code>settingsAsProperties()</code>方法的代码如下所示：</p>
<pre><code class="java">  private Properties settingsAsProperties(XNode context) {
    if (context == null) {
      return new Properties();
    }
    Properties props = context.getChildrenAsProperties();
    // Check that all settings are known to the configuration class
    MetaClass metaConfig = MetaClass.forClass(Configuration.class, localReflectorFactory);
    //使用`MetaClass`检测`key`指定的属性在`Configuration`类中是否有对应`setter`方法的步骤
    for (Object key : props.keySet()) {
      if (!metaConfig.hasSetter(String.valueOf(key))) {
        throw new BuilderException(&quot;The setting &quot; + key + &quot; is not known.  Make sure you spelled it correctly (case sensitive).&quot;);
      }
    }
    return props;
  }</code></pre>
<h2 id="3-3-设置vfsImpl和logImpl"><a href="#3-3-设置vfsImpl和logImpl" class="headerlink" title="3.3. 设置vfsImpl和logImpl"></a>3.3. 设置<code>vfsImpl</code>和<code>logImpl</code></h2><p>这两个参数一般不会去处理，所以我只罗列出来，不去解析：</p>
<h3 id="3-3-1-设置vfsImpl"><a href="#3-3-1-设置vfsImpl" class="headerlink" title="3.3.1. 设置vfsImpl"></a>3.3.1. 设置vfsImpl</h3><p>参看VFS详解</p>
<pre><code class="java">  private void loadCustomVfs(Properties props) throws ClassNotFoundException {
    String value = props.getProperty(&quot;vfsImpl&quot;);
    if (value != null) {
      String[] clazzes = value.split(&quot;,&quot;);
      for (String clazz : clazzes) {
        if (!clazz.isEmpty()) {
          @SuppressWarnings(&quot;unchecked&quot;)
          Class&lt;? extends VFS&gt; vfsImpl = (Class&lt;? extends VFS&gt;)Resources.classForName(clazz);
          configuration.setVfsImpl(vfsImpl);
        }
      }
    }
  }
</code></pre>
<h3 id="3-3-2-设置logImpl"><a href="#3-3-2-设置logImpl" class="headerlink" title="3.3.2. 设置logImpl"></a>3.3.2. 设置logImpl</h3><pre><code class="java">  private void loadCustomLogImpl(Properties props) {
    Class&lt;? extends Log&gt; logImpl = resolveClass(props.getProperty(&quot;logImpl&quot;));
    configuration.setLogImpl(logImpl);
  }</code></pre>
<h2 id="3-4-解析-lt-typeAliases-gt-节点"><a href="#3-4-解析-lt-typeAliases-gt-节点" class="headerlink" title="3.4. 解析&lt;typeAliases&gt;节点"></a>3.4. 解析<code>&lt;typeAliases&gt;</code>节点</h2><p><code>XMLConfigBuilder.typeAliasesElement()</code>负责解析<code>&lt;typeAliases&gt;</code>节点及其子节点，然后利用<a href="https://gnehcgnaw.github.io/Mybatis源码分析/基础支持层/类型转换.html#4-TypeAliasRegistry" target="_blank" rel="noopener">TypeAliasRegistry</a>完成别名的注册，具体实现如下所示：</p>
<pre><code class="java">private void typeAliasesElement(XNode parent) {
    if (parent != null) {
      for (XNode child : parent.getChildren()) {
        /**
         * 指定报名，MyBatis 会在包名下面搜索需要的 Java Bean
         * 每一个在包 domain.blog 中的 Java Bean，在没有注解的情况下，会使用 Bean 的首字母小写的非限定类名来作为它的别名。
         * 比如 domain.blog.Author 的别名为 author；若有注解，则别名为其注解值 。
         */
        if (&quot;package&quot;.equals(child.getName())) {
          String typeAliasPackage = child.getStringAttribute(&quot;name&quot;);
          configuration.getTypeAliasRegistry().registerAliases(typeAliasPackage);
        } else {
          String alias = child.getStringAttribute(&quot;alias&quot;);
          String type = child.getStringAttribute(&quot;type&quot;);
          try {
            Class&lt;?&gt; clazz = Resources.classForName(type);
            if (alias == null) {
              typeAliasRegistry.registerAlias(clazz);
            } else {
              typeAliasRegistry.registerAlias(alias, clazz);
            }
          } catch (ClassNotFoundException e) {
            throw new BuilderException(&quot;Error registering typeAlias for &#39;&quot; + alias + &quot;&#39;. Cause: &quot; + e, e);
          }
        }
      }
    }
  }
</code></pre>
<h2 id="3-5-解析-lt-plugins-gt-节点"><a href="#3-5-解析-lt-plugins-gt-节点" class="headerlink" title="3.5. 解析&lt;plugins&gt;节点"></a>3.5. 解析<code>&lt;plugins&gt;</code>节点</h2><p>插件是<code>Mybatis</code>提供的扩展机制之一，用户可以通过添加自定义插件在<code>SQL</code>语句执行过程中的某一点进行拦截。<code>Mybatis</code>中的自定义插件只需要实现<code>Interceptor</code>接口，并通过注解指定想要拦截的方法签名即可。在高级主题模块，将详细介绍插件的使用和原理，这里先来分析<code>Mybatis</code>中如何加载和管理插件。</p>
<p><code>XMLConfigBuilder.pluginElement()</code>方法负责解析<code>&lt;plugins&gt;</code>节点中定义的插件，并完成实例化和配置操作，具体实现如下所示：</p>
<pre><code class="java"> private void pluginElement(XNode parent) throws Exception {
    if (parent != null) {
      //遍历全部的子节点，即遍历&lt;plugins&gt;
      for (XNode child : parent.getChildren()) {
        //获取&lt;plugin&gt;节点的interceptor属性的值
        String interceptor = child.getStringAttribute(&quot;interceptor&quot;);
        //获取&lt;plugin&gt;下&lt;properties&gt;配置的信息，并形成Properties对象
        Properties properties = child.getChildrenAsProperties();
        //通过别名获取对应的Clazz，然后通过反射实例化Interceptor对象
        Interceptor interceptorInstance = (Interceptor) resolveClass(interceptor).getDeclaredConstructor().newInstance();
        //为当前interceptor设置属性值
        interceptorInstance.setProperties(properties);
        //记录Interceptor对象
        configuration.addInterceptor(interceptorInstance);
      }
    }
  }
</code></pre>
<h2 id="3-6-解析-lt-objectFactory-gt-、-lt-objectWrapperFactory-gt-、-lt-reflectorFactory-gt-节点"><a href="#3-6-解析-lt-objectFactory-gt-、-lt-objectWrapperFactory-gt-、-lt-reflectorFactory-gt-节点" class="headerlink" title="3.6. 解析&lt;objectFactory&gt;、&lt;objectWrapperFactory&gt;、&lt;reflectorFactory&gt;节点"></a>3.6. 解析<code>&lt;objectFactory&gt;</code>、<code>&lt;objectWrapperFactory&gt;</code>、<code>&lt;reflectorFactory&gt;</code>节点</h2><p>我们可以通过自定义添加ObjectFactory、ObjectWarpperFactroy、<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/%E8%A7%A3%E6%9E%90%E5%99%A8%E6%A8%A1%E5%9D%97.html#4-XPathParser" target="_blank" rel="noopener">ReflectorFactory</a>的实现类来扩展<code>Mybatis</code>。</p>
<p><code>XMLConfigBuilder.objectFactoryElement()</code>方法负责解析并实例化<code>&lt;objectFactory&gt;</code>节点指定的<code>ObjectFactory</code>的实现类，之后将自定义的<code>ObjectFactory</code>对象记录在<code>Configuration.objectFactory</code>字段中，具体实现如下所示：</p>
<pre><code class="java">
  private void objectFactoryElement(XNode context) throws Exception {
    if (context != null) {
      //获取&lt;objectFactory&gt;中的type属性
      String type = context.getStringAttribute(&quot;type&quot;);
      //获取&lt;objectFactory&gt;节点下的配置信息，并形成Properties对象
      Properties properties = context.getChildrenAsProperties();
      //通过别名获取对应的clazz，然后实例化ObjectFactory
      ObjectFactory factory = (ObjectFactory) resolveClass(type).getDeclaredConstructor().newInstance();
      //为实例化的ObjectFactory对象设置属性
      factory.setProperties(properties);
      //记录ObjectFactory对象
      configuration.setObjectFactory(factory);
    }
  }</code></pre>
<p>XMLConfigBuilder对<code>&lt;objectWrapperFactory&gt;</code>和<code>&lt;reflectorFactory&gt;</code>节点的解析，和上述过程类似。</p>
<h2 id="3-7-将settings值设置到Configuration中"><a href="#3-7-将settings值设置到Configuration中" class="headerlink" title="3.7. 将settings值设置到Configuration中"></a>3.7. 将<code>settings</code>值设置到<code>Configuration</code>中</h2><p><code>XMLConfigBuilder.settingsElement()</code>这个就是最简单的赋值操作，如下所示：</p>
<pre><code class="java">  private void settingsElement(Properties props) {
    configuration.setAutoMappingBehavior(AutoMappingBehavior.valueOf(props.getProperty(&quot;autoMappingBehavior&quot;, &quot;PARTIAL&quot;)));
    configuration.setAutoMappingUnknownColumnBehavior(AutoMappingUnknownColumnBehavior.valueOf(props.getProperty(&quot;autoMappingUnknownColumnBehavior&quot;, &quot;NONE&quot;)));
    configuration.setCacheEnabled(booleanValueOf(props.getProperty(&quot;cacheEnabled&quot;), true));
    configuration.setProxyFactory((ProxyFactory) createInstance(props.getProperty(&quot;proxyFactory&quot;)));
    configuration.setLazyLoadingEnabled(booleanValueOf(props.getProperty(&quot;lazyLoadingEnabled&quot;), false));
    configuration.setAggressiveLazyLoading(booleanValueOf(props.getProperty(&quot;aggressiveLazyLoading&quot;), false));
    configuration.setMultipleResultSetsEnabled(booleanValueOf(props.getProperty(&quot;multipleResultSetsEnabled&quot;), true));
    configuration.setUseColumnLabel(booleanValueOf(props.getProperty(&quot;useColumnLabel&quot;), true));
    configuration.setUseGeneratedKeys(booleanValueOf(props.getProperty(&quot;useGeneratedKeys&quot;), false));
    configuration.setDefaultExecutorType(ExecutorType.valueOf(props.getProperty(&quot;defaultExecutorType&quot;, &quot;SIMPLE&quot;)));
    configuration.setDefaultStatementTimeout(integerValueOf(props.getProperty(&quot;defaultStatementTimeout&quot;), null));
    configuration.setDefaultFetchSize(integerValueOf(props.getProperty(&quot;defaultFetchSize&quot;), null));
    configuration.setDefaultResultSetType(resolveResultSetType(props.getProperty(&quot;defaultResultSetType&quot;)));
    configuration.setMapUnderscoreToCamelCase(booleanValueOf(props.getProperty(&quot;mapUnderscoreToCamelCase&quot;), false));
    configuration.setSafeRowBoundsEnabled(booleanValueOf(props.getProperty(&quot;safeRowBoundsEnabled&quot;), false));
    configuration.setLocalCacheScope(LocalCacheScope.valueOf(props.getProperty(&quot;localCacheScope&quot;, &quot;SESSION&quot;)));
    configuration.setJdbcTypeForNull(JdbcType.valueOf(props.getProperty(&quot;jdbcTypeForNull&quot;, &quot;OTHER&quot;)));
    configuration.setLazyLoadTriggerMethods(stringSetValueOf(props.getProperty(&quot;lazyLoadTriggerMethods&quot;), &quot;equals,clone,hashCode,toString&quot;));
    configuration.setSafeResultHandlerEnabled(booleanValueOf(props.getProperty(&quot;safeResultHandlerEnabled&quot;), true));
    configuration.setDefaultScriptingLanguage(resolveClass(props.getProperty(&quot;defaultScriptingLanguage&quot;)));
    configuration.setDefaultEnumTypeHandler(resolveClass(props.getProperty(&quot;defaultEnumTypeHandler&quot;)));
    configuration.setCallSettersOnNulls(booleanValueOf(props.getProperty(&quot;callSettersOnNulls&quot;), false));
    configuration.setUseActualParamName(booleanValueOf(props.getProperty(&quot;useActualParamName&quot;), true));
    configuration.setReturnInstanceForEmptyRow(booleanValueOf(props.getProperty(&quot;returnInstanceForEmptyRow&quot;), false));
    configuration.setLogPrefix(props.getProperty(&quot;logPrefix&quot;));
    configuration.setConfigurationFactory(resolveClass(props.getProperty(&quot;configurationFactory&quot;)));
  }</code></pre>
<h2 id="3-8-解析-lt-environments-gt-节点"><a href="#3-8-解析-lt-environments-gt-节点" class="headerlink" title="3.8. 解析&lt;environments&gt;节点"></a>3.8. 解析<code>&lt;environments&gt;</code>节点</h2><p>在实际生产中，同一项目可能分为开发、测试和生产多个不同的环境，每个环境的配置可能不尽相同。Mybatis可以配置多个<code>&lt;environment&gt;</code>节点，每个<code>&lt;environment&gt;</code>节点对应一种环境的配置。但是需要注意的是，尽管可以配置多环境，每个SqlSessionFactory实例只能选择其一。</p>
<p><code>XMLConfigBuilder.environmentElement()</code>方法负责解析<code>&lt;environment&gt;</code>的相关配置，它会根据<code>XMLConfigBuilder.environmen</code>t字段值确定要使用的<code>&lt;environment&gt;</code>配置，之后创建对应的<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/Transaction.html#2-TranscationFactory" target="_blank" rel="noopener">TransactionFactory</a>和<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/DataSource.html#2-DataSourceFactory" target="_blank" rel="noopener">DataSourceFactroy</a>对象，通过<code>DataSourceFactory.getDataSource()</code>获取<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E5%9F%BA%E7%A1%80%E6%94%AF%E6%8C%81%E5%B1%82/Transaction.html#2-TranscationFactory" target="_blank" rel="noopener">DataSource</a>对象，并封装进<code>Environment</code>对象中。<code>environmentElement()</code>方法的具体实现如下：</p>
<pre><code class="java"> private void environmentsElement(XNode context) throws Exception {
    if (context != null) {
      //未指定XMLConfigBuilder#environment字段的值，那么使用default属性指定的&lt;environment&gt;&lt;/environment&gt;
      if (environment == null) {
        environment = context.getStringAttribute(&quot;default&quot;);
      }
      for (XNode child : context.getChildren()) {
        String id = child.getStringAttribute(&quot;id&quot;);
        //检测字段与XMLConfigBuilder#environment字段是否匹配
        if (isSpecifiedEnvironment(id)) {
          //创建TransactionFactory：具体实现是先通过TypeAliasRegistry解析别名之后，实例化TransactionFactory
          TransactionFactory txFactory = transactionManagerElement(child.evalNode(&quot;transactionManager&quot;));
          //创建DataSourceFactory然后得到DataSource
          DataSourceFactory dsFactory = dataSourceElement(child.evalNode(&quot;dataSource&quot;));
          DataSource dataSource = dsFactory.getDataSource();
          //创建Environment对象，Environment中封装了上面创建的TransactionFactory和DataSource对象，这里应用的是建造者模式
          Environment.Builder environmentBuilder = new Environment.Builder(id)
              .transactionFactory(txFactory)
              .dataSource(dataSource);
          //将Environment对象，记录在Configuration.environment字段中
          configuration.setEnvironment(environmentBuilder.build());
        }
      }
    }
  }
</code></pre>
<h2 id="3-9-解析-lt-databaseIdProvider-gt-节点"><a href="#3-9-解析-lt-databaseIdProvider-gt-节点" class="headerlink" title="3.9.  解析&lt;databaseIdProvider&gt;节点"></a>3.9.  解析<code>&lt;databaseIdProvider&gt;</code>节点</h2><p><code>Mybatis</code>不能像<code>Hibernate</code>那样使用<a href="https://docs.jboss.org/hibernate/orm/6.0/userguide/html_single/Hibernate_User_Guide.html#database-dialect" target="_blank" rel="noopener">hibernate.dialect</a>进行设置，然后直接帮助开发人员屏蔽多种数据库产品在<code>SQL</code>语言支持方言的差异。但是可以在<code>mybatis-config.xml</code>配置文件中，通过<code>&lt;databaseIdProvider&gt;</code>定义所有支持的数据库产品的<code>databaseId</code>，然后在映射文件中定义<code>SQL</code>语句节点中，通过<code>databaseId</code>指定该<code>SQL</code>语句应用的数据库产品，这样也可以实现类似的功能。</p>
<p>在<code>Mybatis</code>初始化时，会根据前面确定的<code>DataSource</code>确定当前使用的数据库产品，然后在解析映射配置文件时，加载不带<code>databaseId</code>属性和带有匹配当前数据库<code>databaseId</code>属性的所有<code>SQL</code>语句。如果同时找到了带<code>databaseId</code>和不带<code>databaseId</code>的相同语句，则后者会被舍弃，使用前者。</p>
<p><code>XMLConfigBuilder.databaseIdProviderElement()</code>方法负责解析<code>&lt;databaseIdProvider&gt;</code>节点，并创建指定的DatabaseIdProvider对象。<code>DatabaseIdProvider</code>会返回一个<code>databaseId</code>值，<code>Mybatis</code>会根据<code>databaseId</code>选择合适的<code>SQL</code>去执行。</p>
<pre><code class="java">private void databaseIdProviderElement(XNode context) throws Exception {
    DatabaseIdProvider databaseIdProvider = null;
    if (context != null) {
      String type = context.getStringAttribute(&quot;type&quot;);
      // awful patch to keep backward compatibility
      //为了保证兼容性，修改type取值 &lt;databaseIdProvider type=&quot;DB_VENDOR&quot;&gt;
      if (&quot;VENDOR&quot;.equals(type)) {
        type = &quot;DB_VENDOR&quot;;
      }
      //解析相关配置信息
      Properties properties = context.getChildrenAsProperties();
      //创建DatabaseIdProvider对象
      databaseIdProvider = (DatabaseIdProvider) resolveClass(type).getDeclaredConstructor().newInstance();
      //配置DatabaseIdProvider，完成初始化
      databaseIdProvider.setProperties(properties);
    }
    Environment environment = configuration.getEnvironment();
    if (environment != null &amp;&amp; databaseIdProvider != null) {
      //通过前面确定的DataSource获取databaseId,并记录到Configuration.databaseId字段中
      String databaseId = databaseIdProvider.getDatabaseId(environment.getDataSource());
      configuration.setDatabaseId(databaseId);
    }
  }</code></pre>
<h2 id="3-10-解析-lt-typeHandlers-gt-节点"><a href="#3-10-解析-lt-typeHandlers-gt-节点" class="headerlink" title="3.10. 解析&lt;typeHandlers&gt;节点"></a>3.10. 解析<code>&lt;typeHandlers&gt;</code>节点</h2><h2 id="3-11-解析-lt-mappers-gt-节点"><a href="#3-11-解析-lt-mappers-gt-节点" class="headerlink" title="3.11. 解析&lt;mappers&gt;节点"></a>3.11. 解析<code>&lt;mappers&gt;</code>节点</h2><p>在<code>Mybatis</code>初始化时，除了加载<code>mybatis-config.xml</code>配置文件，还会加载全部的映射配置文件，<code>mybatis-config.xml</code>配置文件中的<code>&lt;mappers&gt;</code>节点会告诉我<code>Mybatis</code>去哪些位置查找映射配置文件以及使用了配置注解表示的接口。</p>
<p><code>XMLConfigBuilder.mapperElement()</code>方法负责解析<code>&lt;mappers&gt;</code>节点，它会创建<code>XMLMapperBuilder</code>对象加载映射文件，如果映射配置文件存在相应的<code>Mapper</code>接口，也会加载相应的<code>Mapper</code>接口，解析其中的注解并完成向<code>MapperRegistry</code>的注册。</p>
<pre><code class="java">  private void mapperElement(XNode parent) throws Exception {
    if (parent != null) {
      //处理&lt;mappers&gt;的子节点
      for (XNode child : parent.getChildren()) {
        //处理&lt;package&gt;节点
        if (&quot;package&quot;.equals(child.getName())) {
          String mapperPackage = child.getStringAttribute(&quot;name&quot;);
          //扫描指定的包，并向MapperRegistry注册Mapper接口
          configuration.addMappers(mapperPackage);
        } else {
          //获取&lt;mapper&gt;节点的resource、url、class属性，这三个属性是互斥的
          String resource = child.getStringAttribute(&quot;resource&quot;);
          String url = child.getStringAttribute(&quot;url&quot;);
          String mapperClass = child.getStringAttribute(&quot;class&quot;);
          //如果&lt;mapper&gt;节点指定了resource或者url属性，则创建XMLMapperBuilder对象，并通过该对象解析resource或url属性指定的Mapper配置文件
          if (resource != null &amp;&amp; url == null &amp;&amp; mapperClass == null) {
            ErrorContext.instance().resource(resource);
            InputStream inputStream = Resources.getResourceAsStream(resource);
            //创建XMLMapperBuilder对象，解析映射配置文件
            XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments());
            mapperParser.parse();
          } else if (resource == null &amp;&amp; url != null &amp;&amp; mapperClass == null) {
            ErrorContext.instance().resource(url);
            InputStream inputStream = Resources.getUrlAsStream(url);
            //创建XMLMapperBuilder对象，解析映射配置文件
            XMLMapperBuilder mapperParser = new XMLMapperBuilder(inputStream, configuration, url, configuration.getSqlFragments());
            mapperParser.parse();
          } else if (resource == null &amp;&amp; url == null &amp;&amp; mapperClass != null) {
            Class&lt;?&gt; mapperInterface = Resources.classForName(mapperClass);
            //如果&lt;mapper&gt;节点指定了class属性，则向MapperRegistry注册该Mapper接口
            configuration.addMapper(mapperInterface);
          } else {
            throw new BuilderException(&quot;A mapper element may only specify a url, resource or class, but not more than one.&quot;);
          }
        }
      }
    }
  }</code></pre>
<p><code>Mybatis</code>初始化过程中对<code>mybatis-config.xml</code>配置文件的解析过程到这里也就结束了，<a href="https://gnehcgnaw.github.io/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/%E6%A0%B8%E5%BF%83%E5%A4%84%E7%90%86%E5%B1%82/Mybatis%E5%88%9D%E5%A7%8B%E5%8C%96(%E4%BA%8C).html" target="_blank" rel="noopener">Mybatis初始化（二）</a>会接续介绍，介绍<code>Mybatis</code>对映射文件的解析过程。</p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">Mybatis源码分析</a>
                  &nbsp;
                
                  <a class="hover-with-bg" href="/categories/%E6%A0%B8%E5%BF%83%E5%A4%84%E7%90%86%E5%B1%82">核心处理层</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Mybatis%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">Mybatis源码分析</a>
                
              </span>
            
            </p>
            
              <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <b>Contact me at :</b>
    <a href="https://github.com/gnehcgnaw" target="_blank" rel="nofollow noopener"><i class="fab fa-github"></i></a>
    <a href="mailto:gnehcgnaw@gmail.com" target="_blank" rel="nofollow noopener"><i class="fas fa-envelope-square"></i></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    

  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  

  

  

  

  




  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Mybatis初始化(一)&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
